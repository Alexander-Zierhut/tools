version: 2.1

orbs:
  orb-tools: circleci/orb-tools@7.3.0
  linter: thekevjames/linter@volatile

workflows:
  run-jobs:
    jobs:
      - linter/pre-commit:
          python_version: 3.7.2-alpine3.8
          pre-steps:
            - run: apk add -U git

      - orb-tools/lint:
          name: lint-orbs-linter
          lint-dir: circleci-orbs/linter
      - orb-tools/pack:
          name: pack-orbs-linter
          source-dir: circleci-orbs/linter
          requires:
            - lint-orbs-linter
      - orb-tools/publish-dev:
          context: org-global
          name: publish-dev-orbs-linter
          orb-name: thekevjames/linter
          requires:
            - linter/pre-commit
            - pack-orbs-linter
      - orb-tools/dev-promote-prod:
          context: org-global
          name: dev-promote-prod-orbs-linter
          orb-name: thekevjames/linter
          # TODO: allow major and minor semver updates
          release: patch
          requires:
            - publish-dev-orbs-linter

      - orb-tools/lint:
          name: lint-orbs-deployment-notifier
          lint-dir: circleci-orbs/deployment-notifier
      - orb-tools/pack:
          name: pack-orbs-deployment-notifier
          source-dir: circleci-orbs/deployment-notifier
          requires:
            - lint-orbs-deployment-notifier
      - orb-tools/publish-dev:
          context: org-global
          name: publish-dev-orbs-deployment-notifier
          orb-name: thekevjames/deployment-notifier
          requires:
            - linter/pre-commit
            - pack-orbs-deployment-notifier
      - orb-tools/dev-promote-prod:
          context: org-global
          name: dev-promote-prod-orbs-deployment-notifier
          orb-name: thekevjames/deployment-notifier
          # TODO: allow major and minor semver updates
          release: patch
          requires:
            - publish-dev-orbs-deployment-notifier
